"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4236],{62869:function(e,t,r){r.d(t,{d:function(){return u},z:function(){return s}});var o=r(57437),n=r(2265),l=r(37053),a=r(90535),i=r(94508);let u=(0,a.j)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-xl text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 active:scale-[0.98]",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90 shadow-md shadow-primary/15",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90 shadow-sm",outline:"border border-input/70 bg-background/70 backdrop-blur hover:bg-accent/70 hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80 shadow-sm",ghost:"hover:bg-accent/70 hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline",gradient:"gradient-egyptian text-white hover:opacity-90 shadow-md transition-opacity"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-lg px-3",lg:"h-11 rounded-xl px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),s=n.forwardRef((e,t)=>{let{className:r,variant:n,size:a,asChild:s=!1,...d}=e,c=s?l.g7:"button";return(0,o.jsx)(c,{className:(0,i.cn)(u({variant:n,size:a,className:r})),ref:t,...d})});s.displayName="Button"},94508:function(e,t,r){r.d(t,{cn:function(){return l}});var o=r(61994),n=r(53335);function l(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,n.m6)((0,o.W)(t))}},46102:function(e,t,r){r.d(t,{$h:function(){return c},YA:function(){return l},_y:function(){return u},gL:function(){return h},l4:function(){return a},mF:function(){return m},qQ:function(){return g},ru:function(){return i},zN:function(){return f}});var o=r(38059),n=r(72218);let{useLoginMutation:l,useRegisterMutation:a,useRefreshTokenMutation:i,useLogoutMutation:u,useGetCurrentUserQuery:s,useUpdateProfileMutation:d,useChangePasswordMutation:c,useForgotPasswordMutation:f,useResetPasswordMutation:h,useUpdatePreferencesMutation:v,useVerifyEmailMutation:g,useResendOtpMutation:m}=o.h.injectEndpoints({endpoints:e=>({login:e.mutation({query:e=>({url:"/Auth/login",method:"POST",body:e}),transformResponse:e=>{var t,r,o,n,l,a,i;let u=(null==e?void 0:e.data)||e,s=(null==u?void 0:u.expiresIn)||3600,d=Date.now()+1e3*s;return localStorage.setItem("tokenExpiry",d.toString()),{user:{id:(null==u?void 0:null===(t=u.user)||void 0===t?void 0:t.id)||(null==u?void 0:u.userId)||"",name:[null==u?void 0:null===(r=u.user)||void 0===r?void 0:r.firstName,null==u?void 0:null===(o=u.user)||void 0===o?void 0:o.lastName].filter(Boolean).join(" "),email:(null==u?void 0:null===(n=u.user)||void 0===n?void 0:n.email)||"",role:"number"==typeof(null==u?void 0:null===(l=u.user)||void 0===l?void 0:l.role)?1===u.user.role?"admin":"tourist":null==u?void 0:null===(a=u.user)||void 0===a?void 0:a.role,emailVerified:null==u?void 0:null===(i=u.user)||void 0===i?void 0:i.emailVerified,createdAt:"",updatedAt:""},token:null==u?void 0:u.accessToken,refreshToken:null==u?void 0:u.refreshToken,expiresIn:s}},onQueryStarted:async(e,t)=>{let{dispatch:r,queryFulfilled:o}=t;r((0,n.K4)(!0));try{let{data:e}=await o;r((0,n.Dj)(e))}catch(t){var l,a;r((0,n.K4)(!1));let e=(null==t?void 0:null===(a=t.error)||void 0===a?void 0:null===(l=a.data)||void 0===l?void 0:l.message)||"Login failed";r((0,n.sT)(e))}}}),register:e.mutation({query:e=>({url:"/Auth/register",method:"POST",body:e}),transformResponse:e=>{let t=(null==e?void 0:e.data)||e,r=(null==t?void 0:t.expiresIn)||3600,o=Date.now()+1e3*r;return localStorage.setItem("tokenExpiry",o.toString()),{user:{id:(null==t?void 0:t.userId)||"",name:[null==t?void 0:t.firstName,null==t?void 0:t.lastName].filter(Boolean).join(" "),email:(null==t?void 0:t.email)||"",role:"number"==typeof(null==t?void 0:t.role)?1===t.role?"admin":"tourist":null==t?void 0:t.role,emailVerified:!1,createdAt:"",updatedAt:""},token:(null==t?void 0:t.accessToken)||"",refreshToken:(null==t?void 0:t.refreshToken)||"",expiresIn:r}},onQueryStarted:async(e,t)=>{let{dispatch:r,queryFulfilled:o}=t;r((0,n.K4)(!0));try{let{data:e}=await o;r((0,n.Dj)(e))}catch(t){var l,a;r((0,n.K4)(!1));let e=(null==t?void 0:null===(a=t.error)||void 0===a?void 0:null===(l=a.data)||void 0===l?void 0:l.message)||"Registration failed";r((0,n.sT)(e))}}}),refreshToken:e.mutation({query:e=>{let{refreshToken:t}=e;return{url:"/Auth/refresh",method:"POST",body:{refreshToken:t}}},transformResponse:e=>{let t=(null==e?void 0:e.data)||e;return{user:void 0,token:null==t?void 0:t.accessToken,refreshToken:null==t?void 0:t.refreshToken}}}),logout:e.mutation({query:e=>{let{refreshToken:t}=e;return{url:"/Auth/logout",method:"POST",body:{refreshToken:t}}},onQueryStarted:async(e,t)=>{let{dispatch:r,queryFulfilled:o}=t;try{await o,r((0,n.Cd)())}catch(e){r((0,n.Cd)())}}}),getCurrentUser:e.query({query:()=>"/auth/me",providesTags:["User"],onQueryStarted:async(e,t)=>{let{dispatch:r,queryFulfilled:o}=t;try{let{data:e}=await o;r((0,n.av)(e))}catch(e){}}}),updateProfile:e.mutation({query:e=>({url:"/auth/profile",method:"PUT",body:e}),invalidatesTags:["User"]}),changePassword:e.mutation({query:e=>{let{currentPassword:t,newPassword:r}=e;return{url:"/Auth/change-password",method:"POST",body:{currentPassword:t,newPassword:r}}}}),forgotPassword:e.mutation({query:e=>{let{email:t}=e;return{url:"/Auth/forgot-password",method:"POST",body:{email:t}}}}),resetPassword:e.mutation({query:e=>{let{email:t,otp:r,newPassword:o}=e;return{url:"/Auth/reset-password",method:"POST",body:{email:t,otp:r,newPassword:o}}}}),updatePreferences:e.mutation({query:e=>({url:"/auth/preferences",method:"PUT",body:e}),invalidatesTags:["User"]}),verifyEmail:e.mutation({query:e=>{let{email:t,otp:r}=e;return{url:"/Auth/verify-email",method:"POST",body:{email:t,otp:r}}}}),resendOtp:e.mutation({query:e=>{let{email:t}=e;return{url:"/Auth/resend-otp",method:"POST",body:{email:t}}}})})})},72218:function(e,t,r){r.d(t,{Cd:function(){return s},Dj:function(){return d},K4:function(){return a},av:function(){return f},sT:function(){return i},vJ:function(){return c}});var o=r(39129);let n={user:(e=>{try{let t=localStorage.getItem(e);return t?JSON.parse(t):null}catch(e){return null}})("user"),token:localStorage.getItem("token"),refreshToken:localStorage.getItem("refreshToken"),isAuthenticated:!!localStorage.getItem("token"),isLoading:!1,error:null},l=(0,o.oM)({name:"auth",initialState:n,reducers:{setLoading:(e,t)=>{e.isLoading=t.payload},setError:(e,t)=>{e.error=t.payload},clearError:e=>{e.error=null},logout:e=>{e.user=null,e.token=null,e.refreshToken=null,e.isAuthenticated=!1,e.error=null,localStorage.removeItem("token"),localStorage.removeItem("refreshToken"),localStorage.removeItem("tokenExpiry"),localStorage.removeItem("user")},tokenRefreshed:(e,t)=>{let{token:r,refreshToken:o,expiresIn:n}=t.payload;if(e.token=r,e.refreshToken=o,e.isAuthenticated=!0,localStorage.setItem("token",r),localStorage.setItem("refreshToken",o),n){let e=Date.now()+1e3*n;localStorage.setItem("tokenExpiry",e.toString())}},setCredentials:(e,t)=>{let{user:r,token:o,refreshToken:n,expiresIn:l}=t.payload;if(e.user=r,e.token=o,e.refreshToken=n,e.isAuthenticated=!0,e.error=null,e.isLoading=!1,localStorage.setItem("token",o),localStorage.setItem("refreshToken",n),localStorage.setItem("user",JSON.stringify(r)),l){let e=Date.now()+1e3*l;localStorage.setItem("tokenExpiry",e.toString())}},setUser:(e,t)=>{e.user=t.payload,e.isAuthenticated=!0,localStorage.setItem("user",JSON.stringify(t.payload))}}}),{setLoading:a,setError:i,clearError:u,logout:s,setCredentials:d,tokenRefreshed:c,setUser:f}=l.actions;t.ZP=l.reducer},38059:function(e,t,r){r.d(t,{h:function(){return h}});var o=r(79523),n=r(23557),l=r(72218);let a=e=>{try{return window.localStorage.getItem(e)}catch(e){return null}},i=(e,t)=>{try{window.localStorage.setItem(e,t)}catch(e){}},u=e=>{try{window.localStorage.removeItem(e)}catch(e){}},s=()=>{let e=a("tokenExpiry");return!e||Date.now()>=parseInt(e,10)},d=()=>{let e=a("tokenExpiry");if(!e)return!1;let t=Date.now();return parseInt(e,10)-t<3e5},c=(0,o.ni)({baseUrl:"https://kemeteg.runasp.net/api",prepareHeaders:(e,t)=>{var r,o;let{getState:n}=t,l=(null===(o=n())||void 0===o?void 0:null===(r=o.auth)||void 0===r?void 0:r.token)||a("token");return l&&e.set("authorization","Bearer ".concat(l)),e.set("content-type","application/json"),e}}),f=async(e,t,r)=>{if(d()){console.log("Token expiring soon, refreshing proactively...");let e=a("refreshToken");if(e){let o=await c({url:"/Auth/refresh",method:"POST",body:{refreshToken:e}},t,r);if(o.data){let r=o.data,n=(null==r?void 0:r.data)||r,a=null==n?void 0:n.accessToken,u=null==n?void 0:n.refreshToken,s=(null==n?void 0:n.expiresIn)||3600;a&&(i("token",a),u&&i("refreshToken",u),i("tokenExpiry",(Date.now()+1e3*s).toString()),t.dispatch((0,l.vJ)({token:a,refreshToken:u||e,expiresIn:s})),console.log("Token refreshed successfully"))}}}let o=await c(e,t,r);if(o.error&&401===o.error.status){console.log("Unauthorized (401), attempting to refresh token...");let n=a("refreshToken");if(n&&!s()){let a=await c({url:"/Auth/refresh",method:"POST",body:{refreshToken:n}},t,r);if(a.data){let u=a.data,s=(null==u?void 0:u.data)||u,d=null==s?void 0:s.accessToken,f=null==s?void 0:s.refreshToken,h=(null==s?void 0:s.expiresIn)||3600;d&&(i("token",d),f&&i("refreshToken",f),i("tokenExpiry",(Date.now()+1e3*h).toString()),t.dispatch((0,l.vJ)({token:d,refreshToken:f||n,expiresIn:h})),o=await c(e,t,r),console.log("Token refreshed and request retried"))}else console.log("Token refresh failed, logging out..."),u("token"),u("refreshToken"),u("tokenExpiry"),t.dispatch((0,l.Cd)()),window.location.href="/login"}else console.log("No valid refresh token, logging out..."),u("token"),u("refreshToken"),u("tokenExpiry"),t.dispatch((0,l.Cd)()),window.location.href="/login"}return o},h=(0,n.LC)({reducerPath:"api",baseQuery:f,tagTypes:["User","Auth","TravelPlan","Destination","Analytics","Booking","Review","Preference","Notification"],endpoints:()=>({})})}}]);